<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LeetCode Plagiarism Report</title>
  <link href="styles.css" rel="stylesheet" />
</head>

<body>
  <div class="flexbox">
    <div style="float: left;">
      <button type="button" class="gridjs-button" onClick="location.reload()">Home</button>
    </div>
    <div style="float: right;">
      <button type="button" class="gridjs-button" onClick="exportGrid()">Export CSV</button>
    </div>
  </div>
  <div class="container">
    <h1 class="centered">LeetCode Plagiarism Report</h1>
    <p class="centered">LeetCode Weekly Contest 408</p>
  </div><br>
  <div role="complementary" class="gridjs gridjs-container" style="width: 100%;">
    <div class="gridjs-head">
      <div class="gridjs-search table-search" style="float: left;">
        <label for="threshold" id="threshold-label">Similarity Threshold (%):</label>
        <input class="gridjs-input gridjs-search-input" id="threshold" type="number" name="threshold" min="50" max="100" value="80" style="width: 17%;">
        <button type="button" class="gridjs-button" onClick="filterThreshold()">Apply Threshold</button>
      </div>
      <div class="gridjs-search table-search" >
        <input type="search" id="searchInput" placeholder="🔍 Search..." aria-label="🔍 Search..." class="gridjs-input gridjs-search-input">
      </div>
    </div>

  </div>
  <div id="table"></div>

  <script src="script.js"></script>

  <script>
    var griddata;
    const defaultThreshold = 80; // Default threshold value

    const grid = new gridjs.Grid({
      columns: [
        { id: "cheater1_rank", name: "Cheater 1 Rank", formatter: (cell) => parseInt(cell), sort: { compare: (a, b) => parseInt(a) - parseInt(b) } },
        { id: "cheater1_username", name: "Cheater 1 Username", formatter: (cell) => gridjs.html(`<a href="${cell}" target="_blank">${cell.split('/').pop()}</a>`) },
        { id: "cheater1_submission_id", name: "Cheater 1 Submission ID", formatter: (cell) => gridjs.html(`<a href="${cell}" target="_blank">${cell.split('/').pop()}</a>`) },
        { id: "cheater2_rank", name: "Cheater 2 Rank", formatter: (cell) => parseInt(cell), sort: { compare: (a, b) => parseInt(a) - parseInt(b) } },
        { id: "cheater2_username", name: "Cheater 2 Username", formatter: (cell) => gridjs.html(`<a href="${cell}" target="_blank">${cell.split('/').pop()}</a>`) },
        { id: "cheater2_submission_id", name: "Cheater 2 Submission ID", formatter: (cell) => gridjs.html(`<a href="${cell}" target="_blank">${cell.split('/').pop()}</a>`) },
        { id: "similarity_percentage", name: "Similarity (%)", formatter: (cell) => parseInt(cell), sort: { compare: (a, b) => parseInt(a) - parseInt(b) } },
      ],
      fixedHeader: true,
      sort: {
        multiColumn: true
      },
      height: '100%',
      resizable: true,
      data: async () => {
        try {
          const response = await fetch('https://himanshumahajan138.github.io/leetcode_report/Q3_Final_Result.json');
          griddata = await response.json();
          filterThreshold()
          return griddata.data;
        } catch (error) {
          console.error('Error fetching data:', error);
          return [];
        }
      },
      pagination: {
        enabled: true,
        limit: 25,
        summary: true
      },
      className: {
        table: "table-table table-body",
        tr: "table-tr",
        td: "table-td",
        th: "table-th",
        search: "table-search",
        sort: "table-sort",
        pagination: "table-pagination",
        paginationButton: "table-pagination-button",
        paginationButtonNext: "table-pagination-next",
        paginationButtonCurrent: "table-pagination-current",
        paginationButtonPrev: "table-pagination-previous",
        loading: "table-loading",
      },
      language: {
        'pagination': {
          'previous': '<',
          'next': '>',
          'showing': '😃 Displaying',
          'results': () => 'Records',
          'page': 'Page',
          'of': 'of'
        }
      }
    }).render(document.getElementById("table"));

    function exportGrid() {
      downloadBlob(griddata.data, 'export.csv', 'text/csv;charset=utf-8;');
    }

    function convertToCSV(arr) {
      const array = [Object.keys(arr[0])].concat(arr);
      return array.map(it => Object.values(it).toString()).join('\n');
    }

    function downloadBlob(content, filename, contentType) {
      var csvContent = convertToCSV(content);
      var blob = new Blob([csvContent], { type: contentType });
      var url = URL.createObjectURL(blob);

      var pom = document.createElement('a');
      pom.href = url;
      pom.setAttribute('download', filename);
      pom.click();
    }

    function filterThreshold() {
      const thresholdInput = document.getElementById('threshold');
      const threshold = parseInt(thresholdInput.value);

      if (threshold < 50 || threshold > 100) {
        alert("Threshold must be between 50 and 100.");
        return;
      }

      const filteredData = griddata.data.filter(row => parseInt(row.similarity_percentage) >= threshold);
      grid.updateConfig({ data: filteredData }).forceRender();
    }

    function filterSearch() {
      const searchValue = document.getElementById('searchInput').value.toLowerCase();
      
      if (!searchValue) {
        grid.updateConfig({ data: griddata.data }).forceRender();
        filterThreshold()
        return;
      }
      
      const filteredData = griddata.data.filter(row => {
        const values = Object.values(row).map(value => value.toString().toLowerCase());
        return values.some(value => value.includes(searchValue));
      });
      filterThreshold()
      grid.updateConfig({ data: filteredData }).forceRender();
    }

    window.onload = function() {
      document.getElementById('searchInput').addEventListener('input', filterSearch);
    };
  </script>

</body>

</html>
